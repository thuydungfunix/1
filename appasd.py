# -*- coding: utf-8 -*-
"""appASD.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1hD3PJaGU_nheEO_f83cHsMFPyFOSwioq
"""

# -*- coding: utf-8 -*-
import streamlit as st
import numpy as np
from catboost import CatBoostClassifier

# Táº£i mÃ´ hÃ¬nh CatBoost
@st.cache_resource
def load_model():
    model = CatBoostClassifier()
    model.load_model("catboost_model(1).cbm")  # file .cbm báº¡n Ä‘Ã£ train
    return model

model = load_model()

st.set_page_config(page_title="SÃ ng Lá»c Tá»± Ká»·", page_icon="ğŸ§ ", layout="centered")
st.title("ğŸ” á»¨ng dá»¥ng SÃ ng Lá»c Tá»± Ká»· (ASD)")

# Giao diá»‡n nháº­p dá»¯ liá»‡u
def nhap_du_lieu():
    st.header("ğŸ“ Vui lÃ²ng tráº£ lá»i cÃ¡c cÃ¢u há»i sau:")

    # 10 cÃ¢u há»i A1 - A10
    questions = [
        "1. CÃ³ khi nÃ o ngÆ°á»i Ä‘Æ°á»£c Ä‘Ã¡nh giÃ¡ trÃ¡nh giao tiáº¿p báº±ng máº¯t?",
        "2. NgÆ°á»i Ä‘Ã³ cÃ³ thÃ­ch chÆ¡i má»™t mÃ¬nh?",
        "3. NgÆ°á»i Ä‘Ã³ cÃ³ hay láº·p láº¡i tá»«/ngÃ´n ngá»¯ khÃ´ng?",
        "4. NgÆ°á»i Ä‘Ã³ cÃ³ khÃ³ khÄƒn khi hiá»ƒu cáº£m xÃºc ngÆ°á»i khÃ¡c?",
        "5. CÃ³ khi nÃ o ngÆ°á»i Ä‘Ã³ khÃ´ng pháº£n há»“i khi Ä‘Æ°á»£c gá»i tÃªn?",
        "6. NgÆ°á»i Ä‘Ã³ cÃ³ nháº¡y cáº£m vá»›i Ã¢m thanh khÃ´ng?",
        "7. CÃ³ khi nÃ o ngÆ°á»i Ä‘Ã³ khÃ´ng chia sáº» há»©ng thÃº hoáº·c thÃ nh tÃ­ch vá»›i ngÆ°á»i khÃ¡c?",
        "8. NgÆ°á»i Ä‘Ã³ cÃ³ hÃ nh vi láº·p Ä‘i láº·p láº¡i khÃ´ng?",
        "9. NgÆ°á»i Ä‘Ã³ cÃ³ gáº·p khÃ³ khÄƒn khi thay Ä‘á»•i thÃ³i quen hoáº·c mÃ´i trÆ°á»ng khÃ´ng?",
        "10. CÃ³ khi nÃ o ngÆ°á»i Ä‘Ã³ khÃ´ng hiá»ƒu cÃ¡c quy táº¯c xÃ£ há»™i cÆ¡ báº£n khÃ´ng?"
    ]
    a_scores = []
    for q in questions:
        ans = st.selectbox(q, ["KhÃ´ng", "CÃ³"], key=q)
        a_scores.append(1 if ans == "CÃ³" else 0)

    # CÃ¡c Ä‘áº·c trÆ°ng khÃ¡c
    age = st.number_input("11. Tuá»•i cá»§a ngÆ°á»i Ä‘Æ°á»£c Ä‘Ã¡nh giÃ¡:", min_value=1, max_value=100, value=18)
    gender = st.selectbox("12. Giá»›i tÃ­nh:", ["Nam", "Ná»¯"])
    jundice = st.selectbox("13. NgÆ°á»i Ä‘Ã³ cÃ³ bá»‹ vÃ ng da sau sinh khÃ´ng?", ["KhÃ´ng", "CÃ³"])
    autism = st.selectbox("14. Gia Ä‘Ã¬nh báº¡n cÃ³ ngÆ°á»i tá»«ng bá»‹ tá»± ká»· khÃ´ng?", ["KhÃ´ng", "CÃ³"])
    used_app_before = st.selectbox("16. Báº¡n Ä‘Ã£ tá»«ng sá»­ dá»¥ng á»©ng dá»¥ng nÃ y chÆ°a?", ["ChÆ°a", "Rá»“i"])
    relation = st.selectbox("15. Báº¡n lÃ  ai Ä‘á»‘i vá»›i ngÆ°á»i Ä‘Æ°á»£c Ä‘Ã¡nh giÃ¡?",
                            ["Bá»‘", "Máº¹", "Báº£n thÃ¢n", "NgÆ°á»i thÃ¢n khÃ¡c"])


    # MÃ£ hÃ³a dá»¯ liá»‡u
    gender_val = 1 if gender == "Nam" else 0
    jundice_val = 1 if jundice == "CÃ³" else 0
    autism_val = 1 if autism == "CÃ³" else 0
    used_app_val = 1 if used_app == "Rá»“i" else 0

    relation_map = {
        "Bá»‘": [1, 0, 0, 0],
        "Máº¹": [0, 1, 0, 0],
        "Báº£n thÃ¢n": [0, 0, 1, 0],
        "NgÆ°á»i thÃ¢n khÃ¡c": [0, 0, 0, 1]
    }
    relation_val = relation_map[relation]

    # Gá»™p thÃ nh vector Ä‘áº·c trÆ°ng
    features = a_scores + [age, gender_val, jundice_val, autism_val, used_app_val] + relation_val
    return np.array([features])

# HÃ m dá»± Ä‘oÃ¡n
def du_doan(features):
    proba = model.predict_proba(features)[0][1]
    pred = int(proba >= 0.5)
    return pred, proba

# Cháº¡y á»©ng dá»¥ng
input_data = nhap_du_lieu()
if st.button("ğŸ“Š Dá»± Ä‘oÃ¡n kháº£ nÄƒng tá»± ká»·"):
    pred, proba = du_doan(input_data)

    st.subheader("ğŸ” Káº¿t quáº£ sÃ ng lá»c:")
    st.write(f"ğŸ‘‰ XÃ¡c suáº¥t máº¯c tá»± ká»· (ASD): **{proba:.2f}**")

    st.markdown("### ğŸ§­ Gá»£i Ã½ hÃ nh Ä‘á»™ng tiáº¿p theo:")
    if pred == 1:
        st.error("""
        âš ï¸ Nguy cÆ¡ cao máº¯c ASD.
        ğŸ”¹ HÃ£y liÃªn há»‡ chuyÃªn gia tÃ¢m lÃ½ hoáº·c cÆ¡ sá»Ÿ y táº¿ Ä‘á»ƒ Ä‘Æ°á»£c tÆ° váº¥n ká»¹ lÆ°á»¡ng hÆ¡n.
        ğŸ”¹ Ghi chÃ©p láº¡i cÃ¡c biá»ƒu hiá»‡n thÆ°á»ng gáº·p trong cuá»™c sá»‘ng hÃ ng ngÃ y.
        ğŸ”¹ CÃ³ thá»ƒ tham kháº£o tÃ i liá»‡u vá» ASD tá»« WHO, CDC hoáº·c cÃ¡c trung tÃ¢m há»— trá»£ trong nÆ°á»›c.
        """)
    else:
        st.success("""
        âœ… Nguy cÆ¡ tháº¥p máº¯c ASD.
        ğŸ”¹ Báº¡n cÃ³ thá»ƒ yÃªn tÃ¢m á»Ÿ thá»i Ä‘iá»ƒm hiá»‡n táº¡i.
        ğŸ”¹ Náº¿u váº«n cÃ²n bÄƒn khoÄƒn, hÃ£y trao Ä‘á»•i thÃªm vá»›i chuyÃªn gia.
        """)
